# Tutorial Dojo - SOA-C02 - Domain 3: Deployment, Provisioning, and Automation

YOUR TIME: 01:13:29

You have reached 24 of 30 point(s) (80%)

| No  |     | Q                                                                                                                | A                                                                                                                                                                   | Ref                                                             |
| --- | --- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- |
|     |     |                                                                                                                  |                                                                                                                                                                     |                                                                 |
| 1   | ❌  | VPC: Migrate to IPv6. How?                                                                                       | 1. Assign IPv6 CIDR block; 2. Route Table; 3. Security Group; 4. Assign IPv6 address to instance                                                                    | [3.1](#31-vpc-ipv6-migration)                                   |
| 2   | ✅  | Cfn: Ensure instances have completed installing/configuring applications before the ASG update proceeds          | Cfn `UpdatePolicy`: `AutoScalingRollingUpdate`: `WaitOnResourceSignals` + `cfn-signal` helper                                                                       | [3.2. UpdatePolicy - Cfn] [3.2.2. cfn-signal - Cfn]             |
| 3   | ✅  | Cfn: Ensure applications are properly running before the stack creation proceeds                                 | Cfn `CreatePolicy`: `ResourceSignal`: `Count`/`Timeout` + `cfn-signal` helper                                                                                       | [3.3.1. CreatePolicy - Cfn] [3.3.2. CreationPolicy Walkthrough] |
| 4   | ❌  | Tag resources, some tags don't follow company convention. How to identify the resources with non-compliant tags? | Use AWS Config _managed_ rule `required_tags`                                                                                                                       | [3.4.1. required_tags - AWS Config] [3.4.2. Tag Strategies]     |
| 5   | ✅  | App hosted on AWS: send messages to several sub-component, preserved the messages order. Which AWS service?      | SQS FIFO queue                                                                                                                                                      |                                                                 |
| 6   | ✅  | Cfn: EC2 + 3rd-party application. Signal if the instances launch successfully/fail?                              | `cfn-init` + `cfn-signal`                                                                                                                                           | [3.6](#36-cfn-init-vs-cloud-init-vs-user-data)                  |
| 7   | ✅  | EC2: Ensure all instances are updated with lasted security patches ASAP. How?                                    | Use **AWS Systems Manager** _Patch Manager_                                                                                                                         |                                                                 |
| 8   | ✅  | Photo editing app, EC2, S3. Services to scale & decouple?                                                        | ASG (EC2) + SQS                                                                                                                                                     |                                                                 |
| 9   | ✅  | Deploy 12 EC2 instances on distinct underlying hardware. How?                                                    | Instance **placement group**: `spread` (~ default behavior without placement group )/ `partition` / `cluster`                                                       | [3.9](#39-placement-group)                                      |
| 10  | ❌  | 200.000 IOPS in 4KB random I/O read. Which service/resource?                                                     | Use Storage Optimized **Instance** + **EBS** Provisioned IOPS SSD io1/io2                                                                                           |                                                                 |
| 11  | ✅  | Quickly provision infrastructure for a data analysis firm. Which services?                                       | Cfn: EC2, Redshift, EMR                                                                                                                                             |                                                                 |
| 12  | ✅  | Database. Migrate to AWS. Cost-effective, no overhead.                                                           | RDS                                                                                                                                                                 |                                                                 |
| 13  | ✅  | ASG: EC2 instance takes too much time to install dependencies. Improve?                                          | Bake AMI image: 1. Manually; 2. Use EC2 Image Builder                                                                                                               |                                                                 |
| 14  | ✅  | Cfn: Multi accounts/region/environments/teams. Manage update with minimal effect?                                | Use Cfn `StackSet` (not ~~Change Set~~ / ~~Nested Stack~~)                                                                                                          |                                                                 |
| 15  | ✅  | Cfn: Helper script to interpret instance metadata, install packages, create files, start services?               | `cfn-init`. Other cfn helper scripts: `cfn-signal`, `cfn-hup`, `cfn-get-metadata`                                                                                   | [3.15]                                                          |
| 16  | ✅  | Which service provide managed instance of Puppet/Chef?                                                           | AWS OpsWork for Chef/Puppet (deprecated soon) -> use 3rd party SaaS. For AWS OpsWork Stack: migrate to AWS Systems Manager                                          |                                                                 |
| 17  | ✅  | Reduce cost of AWS infrastructure                                                                                | 1. EC2 On-demand -> Reserved Instance (RI); 2. "Prune" EBS volume <- Delete                                                                                         |                                                                 |
| 18  | ✅  | Cfn: Preview proposed changes. How?                                                                              | Use Cfn `Change Set` (not ~~StackSet~~ / ~~Nested Stack~~)                                                                                                          |                                                                 |
| 19  | ✅  | EBS: Deployment policy take least amount of time?                                                                | **AllAtOnce**, Rolling, Rolling with additional batch, Immutable, Traffic Shifting, Blue/Green                                                                      | [3.19]                                                          |
| 20  | ✅  | ASG: Scale base on SQS queue length. How?                                                                        | 1. Create a CloudWatch custom metric for SQS queue attribute `ApproximateNumberOfMessages`; 2. Create a target tracking scaling policy (Which value of SQS metric?) | [3.20] [3.20.2]                                                 |
| 21  | ✅  | EC2: MongoDB. Which EBS volume type?                                                                             | SSD: `General Purpose SSD`, **`Provisioned IOPS SSD`**. <br>HDD: `Throughput Optimized HDD`, `Cold HDD`                                                             | [3.21]                                                          |
| 22  | ✅  | ASG (EC2) + Lambda. Manually deploy. How to automate?                                                            | Use `CodeDeploy` + 2 deployment groups: ASG & Lambda                                                                                                                | [3.22]                                                          |
| 23  | ✅  | Cfn: Keep RDS instance after the stack is deleted.                                                               | Cfn `DeletePolicy`: `Delete` / **`Retain`** / `Snapshot`                                                                                                            | [3.23]                                                          |
| 24  | ❌  | EC2 Image Builder: Orchestrate complex workflow & modify system config across apps?                              | Use AWS Task Orchestrator and Executor (AWSTOE) application                                                                                                         |                                                                 |
| 25  | ❌  | EC2: Slow to boot. Fix?                                                                                          | 1. Baked golden AMI; 2. Use ASG + **Warm Pool** (a pool of pre-initialized EC2 instances that sits alongside an ASG)                                                |                                                                 |
| 26  | ✅  | Lambda: Private RDS, 3rd-party APIs                                                                              | 1. Connect Lambda function to VPC private subnet; 2. Attach a NATGW to public subnet.                                                                               | [3.26.1] [3.26.2]                                               |
| 27  | ❌  | Thread detection system -> monitor malicious activity, anomalous behavior? Which service?                        | Amazon GuardDuty                                                                                                                                                    |                                                                 |
| 28  | ✅  | Website hosted on AWS not showing images on S3. Fix?                                                             | S3 bucket doesn't allow access -> Enable CORS for that domain                                                                                                       |                                                                 |
| 29  | ✅  | AWS Organization: Ensure no S3 bucket deletion.                                                                  | Use Service Control Policy (SCP) to deny permission to delete S3 bucket (`s3:DeleteBucket` action)                                                                  |                                                                 |
| 30  | ✅  | Ensure access logs is enable for all S3 bucket. Most efficient way?                                              | Use AWS Config to track the configuration for S3 access log                                                                                                         |                                                                 |

## 3.1 VPC IPv6 migration

Step 1: Associate an IPv6 CIDR block with your VPC & subnets
Step 2: Update your route tables (to route your IPv6 traffic)
Step 3: Update your security group rules (to include rules for IPv6 addresses)
Step 4: Assign IPv6 addresses to your instances (from the IPv6 address range of your subnet)

## 3.6 cfn-init vs cloud-init vs user-data

|                                      |                                                                                                                                                                                                                                     | Log file                         |
| ------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------- |
| [user-data]                          | Run commands on your Linux instance at launch: perform common automated configuration tasks, run scripts after the instance starts. <br>You can pass two types of user data to Amazon EC2: shell scripts and cloud-init directives. |                                  |
| (user-data) [shell _scripts_]        | Starts with `#!/bin/bash`                                                                                                                                                                                                           |                                  |
| (user-data) [cloud-init _directive_] | Starts with `#cloud-config`. cloud-init _directive_ passed to user-data will be read by [`cloud-init` _package_] & perform cloud instance initialization.                                                                           | `/var/log/cloud-init-output.log` |
| [cfn-init] _helper_                  | The cfn-init helper script reads template metadata from the AWS::CloudFormation::Init key and acts accordingly                                                                                                                      |                                  |

[user-data]: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html
[shell _scripts_]: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html#user-data-shell-scripts
[cloud-init _directive_]: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html#user-data-cloud-init
[`cloud-init` _package_]: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/amazon-linux-ami-basics.html#amazon-linux-cloud-init
[cfn-init]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-init.html

## [Placement group] vs Deployment group

[3.2. UpdatePolicy - Cfn]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html#cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals
[3.2.2. cfn-signal - Cfn]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-signal.html
[3.3.1. CreatePolicy - Cfn]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-creationpolicy.html#cfn-attributes-creationpolicy-resourcesignal
[3.3.2. CreationPolicy Walkthrough]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/deploying.applications.html#deployment-walkthrough-cfn-signal
[3.4.1. required_tags - AWS Config]: https://docs.aws.amazon.com/config/latest/developerguide/required-tags.html
[3.4.2. Tag Strategies]: https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html#tag-strategies
[Placement group]: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html
[3.15]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-helper-scripts-reference.html
[3.19]: https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features.deploy-existing-version.html
[3.20]: https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-using-sqs-queue.html#scale-sqs-queue-cli
[3.20.2]: https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-using-sqs-queue.html#scale-sqs-queue-custom-metric
[3.21]: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-volume-types.html
[3.22]: https://docs.aws.amazon.com/codedeploy/latest/userguide/deployment-groups.html
[3.23]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html
[3.26.1]: https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html#vpc-internet
[3.26.2]: https://repost.aws/knowledge-center/internet-access-lambda-function
